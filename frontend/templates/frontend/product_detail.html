{% extends 'frontend/base.html' %}

{% block productdetail %}
<div class="container div">

</div>

{% endblock %}

{% block productdetailrequest %}
<script text="text/javascript" >

$.ajax({
  url:`http://127.0.0.1:8000/api/products/{{product_id}}`,
  method:'GET',
  success: function(data){
    var container=document.querySelector('.div');
    
    var imgs=''
    data.images.forEach((image,i) => {
      if (i==0){
        imgs+=`
      <div class="carousel-item active ">
        <img style="object-fit:cover;height:400px" class="d-block w-100" src="${image.image}" alt="First slide">
      </div>
      `
      }
      else{
        imgs+=`
      <div class="carousel-item ">
        <img style="object-fit:cover;height:400px" class="d-block w-100 " src="${image.image}" alt="First slide">
      </div>
      `
      }
      
    });
    
    var output=`
    <div  id="carouselExampleControls" class="carousel slide " data-ride="carousel">
    <div class="carousel-inner ">
      ${imgs}
    </div>
    <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>

    <div class="card" style="width: 18rem;">
      
    <div class="card-body">
      <h5 class="card-title">${data.title}</h5>
      <p class="card-title">${data.unit_price}$</p>
      <p class="card-title">${data.inventory} Left in Stock</p>
      <p class="card-text">${data.description}</p>
      <form action="" method="POST">
        <label for="qty">Qty</label>
        <input type="number" id="qty" min="1" required class="qty" value="1"  >
        <a href="#" class="btn btn-primary cart-button">Add to Cart </a>
      </form>
      
    </div>
  </div>
    `
    container.innerHTML +=output
    
    addToCart(data.id)
  }
})

const cart_id=localStorage.getItem('cart_id')
if (cart_id==null){
  $.ajax({
  url:'http://127.0.0.1:8000/api/carts/',
  method:'POST',
  success:function(data){
    localStorage.setItem('cart_id',`${data.id}`)
  }
})

}

function addToCart(product_id){
  
  var button=document.querySelector('.cart-button')
  button.addEventListener('click',function(e){
    var qty=document.querySelector('.qty')
    var quantity=qty.value
    e.preventDefault()
    
    const cart_id=localStorage.getItem('cart_id')
   
    $.ajax({
      url:`http://127.0.0.1:8000/api/carts/${cart_id}/items/`,
      method: 'POST',
      data:{"product":product_id,"quantity":quantity,"csrfmiddlewaretoken": '{{ csrf_token }}'},
      dataType:"json",
      success:function(data){
        
        window.toggleCart()
        
      }
    })
  })
}

</script>
{% endblock %}
